{% extends "base.html" %}
{% load static %}

{% block content %}

<style>
  /* Hareketi sevmeyenler iÃ§in eriÅŸilebilirlik */
  @media (prefers-reduced-motion: reduce) {
    .page-fade { transition: none !important; }
  }

  :root { --fade-duration: 320ms; }

  .page-fade {
    opacity: 0;
    transition: opacity var(--fade-duration) ease;
  }
  .page-fade.is-visible { opacity: 1; }
  .page-fade.is-hidden  { opacity: 0; }
</style>


<!-- **************** MAIN CONTENT START **************** -->
<main id="page-fader" class="page-fade" data-fader>

	<!-- =======================
	Main banner START -->
	<section class="position-relative py-xl-9" style="background-image:url({% static 'assets/images/bg/10.jpg' %}); background-position: center left; background-size: cover;">
		<div class="container z-index-9">
			<div class="row">
				<div class="col-lg-10 m-auto text-center position-relative z-index-9">
          <form class="form-control-inline my-5" action="{% url 'tour_grid' %}" method="get">
            <div class="d-flex flex-wrap justify-content-center align-items-center">

              <!-- x civarÄ±nda -->
              <span class="d-inline-block">
                <select class="form-select js-choice" data-search-enabled="true" name="country">
                  <option value="">SeÃ§iniz</option>
                  {% for c in countries %}
                    <option value="{{ c.id }}">{{ c.name }}</option>
                  {% endfor %}
                </select>
              </span>
              <label class="form-control-inline-text">civarÄ±nda</label>

              <!-- xâ€“y tarihleri arasÄ±nda -->
              <span class="d-inline-block">
                <input type="text" class="form-control flatpickr" name="dates" placeholder="BaÅŸlangÄ±Ã§ - BitiÅŸ">
              </span>
              <label class="form-control-inline-text">tarihleri arasÄ±nda</label>

              <!-- kapanÄ±ÅŸ -->
              <label class="form-control-inline-text">size Ã¶zel bir seyahat deneyimi yaÅŸayÄ±n.</label>
            </div>

            <!-- Button -->
            <button class="icon-xxl bg-primary btn-dark-hover rounded-circle btn fs-6 text-white p-0 mt-4" type="submit">
              RotamÄ± Bul
            </button>
          </form>

				</div>
			</div> <!-- Row END -->
		</div>
	</section>
	<!-- =======================
	Main banner END -->

</main>
<!-- **************** MAIN CONTENT END **************** -->


<script>
(function(){
  const FADE_MS = 320;

  function showFader() {
    const fader = document.querySelector('[data-fader]');
    if (!fader) return;
    // Ã¶nce gizli sÄ±nÄ±fÄ±nÄ± temizle, sonra gÃ¶rÃ¼nÃ¼r yap
    fader.classList.remove('is-hidden');
    // raf ile transition tetikle
    requestAnimationFrame(() => fader.classList.add('is-visible'));
  }

  function wireFormFadeOut() {
    const fader = document.querySelector('[data-fader]');
    const form  = document.querySelector('form.form-control-inline');
    if (!fader || !form) return;

    if (form.dataset.fadeBound === '1') return; // iki kez baÄŸlama
    form.dataset.fadeBound = '1';

    form.addEventListener('submit', function(e){
      const reduce = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
      if (reduce) return;

      e.preventDefault();
      fader.classList.remove('is-visible');
      fader.classList.add('is-hidden');
      setTimeout(() => form.submit(), FADE_MS + 50);
    });
  }

  // Ä°lk yÃ¼kleme
  document.addEventListener('DOMContentLoaded', () => {
    showFader();
    wireFormFadeOut();
  });

  // Geri/ileri gezinmede (BFCache) de tetikle
  window.addEventListener('pageshow', (ev) => {
    // BFCacheâ€™den gelinmiÅŸ olsun olmasÄ±n gÃ¶rÃ¼nÃ¼rlÃ¼ÄŸÃ¼ dÃ¼zelt
    showFader();
    wireFormFadeOut();
  });
})();
</script>

<script>
(function () {
  const RANGE_SEP = ' - '; // URLâ€™de canonical ayraÃ§; gÃ¶rÃ¼nÃ¼m altFormat ayrÄ±

  function initIndexRange() {
    if (!window.flatpickr) return;

    // inputu bul
    const el = document.querySelector('input.flatpickr[name="dates"]');
    if (!el) return;

    // Ã–nce olasÄ± eski instance'Ä± yok et
    if (el._flatpickr) el._flatpickr.destroy();

    // Flatpickr yerelleÅŸtirme
    if (flatpickr.l10ns && flatpickr.l10ns.tr) flatpickr.localize(flatpickr.l10ns.tr);

    // BugÃ¼n + 2 gÃ¼n (flatpickr Date helper'Ä±: fp_incr)
    const minDate = new Date().fp_incr(2); // bugÃ¼n dahil deÄŸil â†’ +2

    // URL'den gelen dates varsa normalize et
    const params = new URLSearchParams(window.location.search);
    const raw = (params.get('dates') || '').trim();
    const isoMatches = raw.match(/\d{4}-\d{2}-\d{2}/g) || [];
    const initial = isoMatches.length >= 2 ? [isoMatches[0], isoMatches[1]] : [];

    // Kurulum
    const fp = flatpickr(el, {
      locale: Object.assign({}, flatpickr.l10ns?.tr || {}, { rangeSeparator: RANGE_SEP }),
      mode: 'range',
      dateFormat: 'Y-m-d',   // URLâ€™e gidecek ham
      altInput: true,
      altFormat: 'd F Y',    // KullanÄ±cÄ±ya gÃ¶rÃ¼nen
      allowInput: true,
      minDate,               // ğŸ”’ en erken 2 gÃ¼n sonrasÄ±
      // Ek gÃ¼venlik: minDateâ€™ten kÃ¼Ã§Ã¼k seÃ§imi engelle/temizle
      onClose: function (selectedDates, dateStr, instance) {
        if (!selectedDates || selectedDates.length === 0) return;
        const tooEarly = selectedDates.some(d => d < minDate);
        if (tooEarly) {
          // minDate'e ittir
          const bumped = selectedDates.map((d,i) => {
            const base = new Date(minDate);
            if (i === 1 && selectedDates.length === 2 && selectedDates[1] < minDate) {
              // bitiÅŸ de minDateâ€™ten kÃ¼Ã§Ã¼kse en az minDate yap
              return base;
            }
            return d < minDate ? base : d;
          });
          instance.setDate(bumped, true, 'Y-m-d');
        }
      },
    });

    // BaÅŸlangÄ±Ã§ deÄŸerini sadece minDate ÅŸartÄ±na uyuyorsa ver
    if (initial.length === 2) {
      const s = new Date(initial[0]);
      const e = new Date(initial[1]);
      if (s >= minDate && e >= minDate && e >= s) {
        fp.setDate(initial, true, 'Y-m-d');
      } else {
        // GeÃ§ersizse temizle
        el.value = '';
        fp.clear();
      }
    }
  }

  // Ä°lk yÃ¼kleme + BFCache dÃ¶nÃ¼ÅŸleri
  document.addEventListener('DOMContentLoaded', initIndexRange);
  window.addEventListener('pageshow', initIndexRange);
})();
</script>




{% endblock %}
